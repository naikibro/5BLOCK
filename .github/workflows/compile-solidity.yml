name: Solidity Compilation

on:
  push:
    branches: [main, develop, epic/**]
    paths:
      - 'contracts/**'
      - 'hardhat.config.ts'
      - 'package.json'
      - '.github/workflows/compile-solidity.yml'
  pull_request:
    branches: [main, develop]
    paths:
      - 'contracts/**'
      - 'hardhat.config.ts'
      - 'package.json'

jobs:
  compile-solidity:
    name: Compile Solidity Contracts
    runs-on: ubuntu-latest
    
    strategy:
      matrix:
        node-version: [20.x]
    
    steps:
      - name: ðŸ“¥ Checkout code
        uses: actions/checkout@v4
      
      - name: ðŸŸ¢ Setup Node.js ${{ matrix.node-version }}
        uses: actions/setup-node@v4
        with:
          node-version: ${{ matrix.node-version }}
          cache: 'npm'
      
      - name: ðŸ“¦ Install dependencies
        run: npm ci
      
      - name: ðŸ§¹ Clean previous artifacts
        run: npm run clean
        continue-on-error: true
      
      - name: ðŸ”¨ Compile Solidity contracts
        run: npm run compile
      
      - name: ðŸ“Š List compiled artifacts
        run: |
          echo "âœ… Compilation successful!"
          echo ""
          echo "ðŸ“¦ Generated artifacts:"
          ls -lah artifacts/contracts/ || echo "No artifacts found"
          echo ""
          echo "ðŸ”§ Generated typechain types:"
          ls -lah typechain-types/ || echo "No typechain types found"
      
      - name: ðŸ“¤ Upload compilation artifacts
        uses: actions/upload-artifact@v4
        with:
          name: solidity-artifacts-${{ matrix.node-version }}
          path: |
            artifacts/
            typechain-types/
          retention-days: 7
      
      - name: âœ… Compilation summary
        run: |
          echo "âœ… All Solidity contracts compiled successfully"
          echo "âœ… Typechain types generated"
